// ChiRho Events - Prisma Schema
// Database: PostgreSQL 15 (Neon)

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

// ===================================
// CORE TABLES
// ===================================

model Organization {
  id                      String   @id @default(uuid()) @db.Uuid
  name                    String   @db.VarChar(255)
  type                    OrganizationType
  address                 Json?
  contactName             String?  @map("contact_name") @db.VarChar(255)
  contactEmail            String   @unique @map("contact_email") @db.VarChar(255)
  contactPhone            String?  @map("contact_phone") @db.VarChar(20)
  stripeAccountId         String?  @unique @map("stripe_account_id") @db.VarChar(255)
  subscriptionTier        SubscriptionTier @map("subscription_tier")
  subscriptionStatus      SubscriptionStatus @map("subscription_status")
  monthlyFee              Decimal  @map("monthly_fee") @db.Decimal(10, 2)
  setupFeePaid            Boolean  @default(false) @map("setup_fee_paid")
  reactivationFeePaid     Boolean  @default(false) @map("reactivation_fee_paid")
  storageUsedGb           Decimal  @default(0) @map("storage_used_gb") @db.Decimal(10, 2)
  storageLimitGb          Int      @map("storage_limit_gb")
  eventsPerYearLimit      Int?     @map("events_per_year_limit")
  logoUrl                 String?  @map("logo_url") @db.Text
  createdAt               DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt               DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)
  archivedAt              DateTime? @map("archived_at") @db.Timestamptz(6)

  // Relations
  users                   User[]
  events                  Event[]
  groupRegistrations      GroupRegistration[]
  individualRegistrations IndividualRegistration[]
  participants            Participant[]
  payments                Payment[]
  paymentBalances         PaymentBalance[]
  liabilityForms          LiabilityForm[]
  safeEnvironmentCertificates SafeEnvironmentCertificate[]
  liabilityFormTemplates  LiabilityFormTemplate[]

  @@index([contactEmail], name: "idx_org_email")
  @@index([stripeAccountId], name: "idx_org_stripe")
  @@map("organizations")
}

model User {
  id              String   @id @default(uuid()) @db.Uuid
  clerkUserId     String?  @map("clerk_user_id") @db.VarChar(255)
  organizationId  String   @map("organization_id") @db.Uuid
  email           String   @unique @db.VarChar(255)
  firstName       String   @map("first_name") @db.VarChar(255)
  lastName        String   @map("last_name") @db.VarChar(255)
  preferredName   String?  @map("preferred_name") @db.VarChar(255)
  role            UserRole
  phone           String?  @db.VarChar(20)
  createdBy       String?  @map("created_by") @db.Uuid
  lastLogin       DateTime? @map("last_login") @db.Timestamptz(6)
  createdAt       DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt       DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  organization    Organization @relation(fields: [organizationId], references: [id])
  createdByUser   User?        @relation("UserCreatedBy", fields: [createdBy], references: [id])
  usersCreated    User[]       @relation("UserCreatedBy")
  eventsCreated   Event[]
  uploadedCertificates SafeEnvironmentCertificate[] @relation("UploadedCertificates")
  verifiedCertificates SafeEnvironmentCertificate[] @relation("VerifiedCertificates")
  registrationEdits RegistrationEdit[]
  refundsProcessed Refund[]

  @@index([organizationId], name: "idx_user_org")
  @@index([email], name: "idx_user_email")
  @@index([role], name: "idx_user_role")
  @@index([clerkUserId], name: "idx_user_clerk")
  @@map("users")
}

model Event {
  id                     String   @id @default(uuid()) @db.Uuid
  organizationId         String   @map("organization_id") @db.Uuid
  name                   String   @db.VarChar(255)
  slug                   String   @unique @db.VarChar(255)
  description            String?  @db.Text
  startDate              DateTime @map("start_date") @db.Date
  endDate                DateTime @map("end_date") @db.Date
  timezone               String   @db.VarChar(50)
  locationName           String?  @map("location_name") @db.VarChar(255)
  locationAddress        Json?    @map("location_address")
  capacityTotal          Int?     @map("capacity_total")
  capacityRemaining      Int?     @map("capacity_remaining")
  registrationOpenDate   DateTime? @map("registration_open_date") @db.Timestamptz(6)
  registrationCloseDate  DateTime? @map("registration_close_date") @db.Timestamptz(6)
  status                 EventStatus @default(draft)
  enableWaitlist         Boolean  @default(false) @map("enable_waitlist")
  waitlistCapacity       Int?     @map("waitlist_capacity")
  createdBy              String   @map("created_by") @db.Uuid
  createdAt              DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt              DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  organization              Organization @relation(fields: [organizationId], references: [id])
  creator                   User         @relation(fields: [createdBy], references: [id])
  settings                  EventSettings?
  pricing                   EventPricing?
  groupRegistrations        GroupRegistration[]
  individualRegistrations   IndividualRegistration[]
  customRegistrationQuestions CustomRegistrationQuestion[]
  liabilityForms            LiabilityForm[]
  liabilityFormTemplates    LiabilityFormTemplate[]
  waitlistEntries           WaitlistEntry[]

  @@index([organizationId], name: "idx_event_org")
  @@index([slug], name: "idx_event_slug")
  @@index([startDate, endDate], name: "idx_event_dates")
  @@map("events")
}

model EventSettings {
  id                              String   @id @default(uuid()) @db.Uuid
  eventId                         String   @unique @map("event_id") @db.Uuid
  groupRegistrationEnabled        Boolean  @default(true) @map("group_registration_enabled")
  individualRegistrationEnabled   Boolean  @default(true) @map("individual_registration_enabled")
  liabilityFormsRequiredGroup     Boolean  @default(true) @map("liability_forms_required_group")
  liabilityFormsRequiredIndividual Boolean @default(false) @map("liability_forms_required_individual")
  showDietaryRestrictions         Boolean  @default(true) @map("show_dietary_restrictions")
  dietaryRestrictionsRequired     Boolean  @default(false) @map("dietary_restrictions_required")
  showAdaAccommodations           Boolean  @default(true) @map("show_ada_accommodations")
  adaAccommodationsRequired       Boolean  @default(false) @map("ada_accommodations_required")
  porosHousingEnabled             Boolean  @default(false) @map("poros_housing_enabled")
  porosPriestHousingEnabled       Boolean  @default(false) @map("poros_priest_housing_enabled")
  porosSeatingEnabled             Boolean  @default(false) @map("poros_seating_enabled")
  porosMealColorsEnabled          Boolean  @default(false) @map("poros_meal_colors_enabled")
  porosSmallGroupEnabled          Boolean  @default(false) @map("poros_small_group_enabled")
  porosSglEnabled                 Boolean  @default(false) @map("poros_sgl_enabled")
  porosSeminarianEnabled          Boolean  @default(false) @map("poros_seminarian_enabled")
  porosReligiousStaffEnabled      Boolean  @default(false) @map("poros_religious_staff_enabled")
  porosAdaEnabled                 Boolean  @default(false) @map("poros_ada_enabled")
  publicPortalEnabled             Boolean  @default(false) @map("public_portal_enabled")
  salveCheckinEnabled             Boolean  @default(false) @map("salve_checkin_enabled")
  raphaMedicalEnabled             Boolean  @default(false) @map("rapha_medical_enabled")
  tshirtsEnabled                  Boolean  @default(false) @map("tshirts_enabled")
  individualMealsEnabled          Boolean  @default(false) @map("individual_meals_enabled")
  registrationInstructions        String?  @map("registration_instructions") @db.Text
  checkPaymentEnabled             Boolean  @default(true) @map("check_payment_enabled")
  checkPaymentPayableTo           String?  @map("check_payment_payable_to") @db.VarChar(255)
  checkPaymentAddress             String?  @map("check_payment_address") @db.Text
  allowOnCampus                   Boolean  @default(true) @map("allow_on_campus")
  allowOffCampus                  Boolean  @default(true) @map("allow_off_campus")
  allowDayPass                    Boolean  @default(true) @map("allow_day_pass")
  landingPageShowPrice            Boolean  @default(true) @map("landing_page_show_price")
  landingPageShowSchedule         Boolean  @default(true) @map("landing_page_show_schedule")
  landingPageShowFaq              Boolean  @default(true) @map("landing_page_show_faq")
  landingPageShowIncluded         Boolean  @default(true) @map("landing_page_show_included")
  landingPageShowBring            Boolean  @default(true) @map("landing_page_show_bring")
  landingPageShowContact          Boolean  @default(true) @map("landing_page_show_contact")
  landingPageShowGallery          Boolean  @default(false) @map("landing_page_show_gallery")
  landingPageShowSponsors         Boolean  @default(false) @map("landing_page_show_sponsors")
  showAvailability                Boolean  @default(true) @map("show_availability")
  availabilityThreshold           Int      @default(20) @map("availability_threshold")
  countdownLocation               String   @default("hero") @map("countdown_location") @db.VarChar(50)
  countdownBeforeOpen             Boolean  @default(true) @map("countdown_before_open")
  countdownBeforeClose            Boolean  @default(true) @map("countdown_before_close")
  backgroundImageUrl              String?  @map("background_image_url") @db.Text
  primaryColor                    String   @default("#1E3A5F") @map("primary_color") @db.VarChar(7)
  secondaryColor                  String   @default("#9C8466") @map("secondary_color") @db.VarChar(7)
  overlayColor                    String   @default("#000000") @map("overlay_color") @db.VarChar(7)
  overlayOpacity                  Int      @default(40) @map("overlay_opacity")
  waitlistEnabled                 Boolean  @default(false) @map("waitlist_enabled")
  registrationClosedMessage       String?  @map("registration_closed_message") @db.Text
  createdAt                       DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                       DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@map("event_settings")
}

model EventPricing {
  id                        String   @id @default(uuid()) @db.Uuid
  eventId                   String   @unique @map("event_id") @db.Uuid
  youthEarlyBirdPrice       Decimal? @map("youth_early_bird_price") @db.Decimal(10, 2)
  youthRegularPrice         Decimal  @map("youth_regular_price") @db.Decimal(10, 2)
  youthLatePrice            Decimal? @map("youth_late_price") @db.Decimal(10, 2)
  chaperoneEarlyBirdPrice   Decimal? @map("chaperone_early_bird_price") @db.Decimal(10, 2)
  chaperoneRegularPrice     Decimal  @map("chaperone_regular_price") @db.Decimal(10, 2)
  chaperoneLatePrice        Decimal? @map("chaperone_late_price") @db.Decimal(10, 2)
  priestPrice               Decimal  @default(0.00) @map("priest_price") @db.Decimal(10, 2)
  onCampusYouthPrice        Decimal? @map("on_campus_youth_price") @db.Decimal(10, 2)
  offCampusYouthPrice       Decimal? @map("off_campus_youth_price") @db.Decimal(10, 2)
  dayPassYouthPrice         Decimal? @map("day_pass_youth_price") @db.Decimal(10, 2)
  onCampusChaperonePrice    Decimal? @map("on_campus_chaperone_price") @db.Decimal(10, 2)
  offCampusChaperonePrice   Decimal? @map("off_campus_chaperone_price") @db.Decimal(10, 2)
  dayPassChaperonePrice     Decimal? @map("day_pass_chaperone_price") @db.Decimal(10, 2)
  individualBasePrice       Decimal? @map("individual_base_price") @db.Decimal(10, 2)
  singleRoomPrice           Decimal? @map("single_room_price") @db.Decimal(10, 2)
  doubleRoomPrice           Decimal? @map("double_room_price") @db.Decimal(10, 2)
  tripleRoomPrice           Decimal? @map("triple_room_price") @db.Decimal(10, 2)
  quadRoomPrice             Decimal? @map("quad_room_price") @db.Decimal(10, 2)
  individualOffCampusPrice  Decimal? @map("individual_off_campus_price") @db.Decimal(10, 2)
  individualMealPackagePrice Decimal? @map("individual_meal_package_price") @db.Decimal(10, 2)
  depositAmount             Decimal? @map("deposit_amount") @db.Decimal(10, 2)
  depositPercentage         Decimal? @map("deposit_percentage") @db.Decimal(5, 2)
  requireFullPayment        Boolean  @default(false) @map("require_full_payment")
  depositPerPerson          Boolean  @default(true) @map("deposit_per_person")
  earlyBirdDeadline         DateTime? @map("early_bird_deadline") @db.Timestamptz(6)
  regularDeadline           DateTime? @map("regular_deadline") @db.Timestamptz(6)
  fullPaymentDeadline       DateTime? @map("full_payment_deadline") @db.Timestamptz(6)
  lateFeePercentage         Decimal? @map("late_fee_percentage") @db.Decimal(5, 2)
  lateFeeAutoApply          Boolean  @default(false) @map("late_fee_auto_apply")
  currency                  String   @default("USD") @db.VarChar(3)
  createdAt                 DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                 DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@map("event_pricing")
}

// ===================================
// REGISTRATION TABLES
// ===================================

model GroupRegistration {
  id                         String   @id @default(uuid()) @db.Uuid
  eventId                    String   @map("event_id") @db.Uuid
  organizationId             String   @map("organization_id") @db.Uuid
  groupName                  String   @map("group_name") @db.VarChar(255)
  parishName                 String?  @map("parish_name") @db.VarChar(255)
  dioceseName                String?  @map("diocese_name") @db.VarChar(255)
  groupLeaderUserId          String?  @map("group_leader_user_id") @db.Uuid
  clerkUserId                String?  @map("clerk_user_id") @db.VarChar(255)
  dashboardLastAccessedAt    DateTime? @map("dashboard_last_accessed_at") @db.Timestamptz(6)
  groupLeaderName            String   @map("group_leader_name") @db.VarChar(255)
  groupLeaderEmail           String   @map("group_leader_email") @db.VarChar(255)
  groupLeaderPhone           String   @map("group_leader_phone") @db.VarChar(20)
  groupLeaderStreet          String?  @map("group_leader_street") @db.VarChar(255)
  groupLeaderCity            String?  @map("group_leader_city") @db.VarChar(100)
  groupLeaderState           String?  @map("group_leader_state") @db.VarChar(2)
  groupLeaderZip             String?  @map("group_leader_zip") @db.VarChar(10)
  alternativeContact1Name    String?  @map("alternative_contact_1_name") @db.VarChar(255)
  alternativeContact1Email   String?  @map("alternative_contact_1_email") @db.VarChar(255)
  alternativeContact1Phone   String?  @map("alternative_contact_1_phone") @db.VarChar(20)
  alternativeContact2Name    String?  @map("alternative_contact_2_name") @db.VarChar(255)
  alternativeContact2Email   String?  @map("alternative_contact_2_email") @db.VarChar(255)
  alternativeContact2Phone   String?  @map("alternative_contact_2_phone") @db.VarChar(20)
  accessCode                 String   @unique @map("access_code") @db.VarChar(50)
  youthCount                 Int      @default(0) @map("youth_count")
  chaperoneCount             Int      @default(0) @map("chaperone_count")
  priestCount                Int      @default(0) @map("priest_count")
  totalParticipants          Int      @map("total_participants")
  housingType                HousingType @map("housing_type")
  specialRequests            String?  @map("special_requests") @db.Text
  dietaryRestrictionsSummary String?  @map("dietary_restrictions_summary") @db.Text
  adaAccommodationsSummary   String?  @map("ada_accommodations_summary") @db.Text
  registrationStatus         RegistrationStatus @default(incomplete) @map("registration_status")
  registeredAt               DateTime @default(now()) @map("registered_at") @db.Timestamptz(6)
  createdAt                  DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                  DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  event          Event           @relation(fields: [eventId], references: [id])
  organization   Organization    @relation(fields: [organizationId], references: [id])
  participants   Participant[]
  liabilityForms LiabilityForm[]

  @@index([eventId], name: "idx_group_event")
  @@index([organizationId], name: "idx_group_org")
  @@index([accessCode], name: "idx_group_access_code")
  @@map("group_registrations")
}

model IndividualRegistration {
  id                        String   @id @default(uuid()) @db.Uuid
  eventId                   String   @map("event_id") @db.Uuid
  organizationId            String   @map("organization_id") @db.Uuid
  userId                    String?  @map("user_id") @db.Uuid
  firstName                 String   @map("first_name") @db.VarChar(255)
  lastName                  String   @map("last_name") @db.VarChar(255)
  preferredName             String?  @map("preferred_name") @db.VarChar(255)
  email                     String   @db.VarChar(255)
  phone                     String   @db.VarChar(20)
  street                    String?  @db.VarChar(255)
  city                      String?  @db.VarChar(100)
  state                     String?  @db.VarChar(2)
  zip                       String?  @db.VarChar(10)
  age                       Int?
  gender                    Gender?
  housingType               HousingType? @map("housing_type")
  roomType                  RoomType? @map("room_type")
  preferredRoommate         String?  @map("preferred_roommate") @db.Text
  tShirtSize                String?  @map("t_shirt_size") @db.VarChar(10)
  dietaryRestrictions       String?  @map("dietary_restrictions") @db.Text
  adaAccommodations         String?  @map("ada_accommodations") @db.Text
  emergencyContact1Name     String   @map("emergency_contact_1_name") @db.VarChar(255)
  emergencyContact1Phone    String   @map("emergency_contact_1_phone") @db.VarChar(20)
  emergencyContact1Relation String?  @map("emergency_contact_1_relation") @db.VarChar(100)
  emergencyContact2Name     String?  @map("emergency_contact_2_name") @db.VarChar(255)
  emergencyContact2Phone    String?  @map("emergency_contact_2_phone") @db.VarChar(20)
  emergencyContact2Relation String?  @map("emergency_contact_2_relation") @db.VarChar(100)
  registrationStatus        RegistrationStatus @default(incomplete) @map("registration_status")
  qrCode                    String?  @map("qr_code") @db.Text
  registeredAt              DateTime @default(now()) @map("registered_at") @db.Timestamptz(6)
  createdAt                 DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                 DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  event        Event        @relation(fields: [eventId], references: [id])
  organization Organization @relation(fields: [organizationId], references: [id])
  liabilityForms LiabilityForm[]

  @@map("individual_registrations")
}

model Participant {
  id                           String   @id @default(uuid()) @db.Uuid
  groupRegistrationId          String   @map("group_registration_id") @db.Uuid
  organizationId               String   @map("organization_id") @db.Uuid
  firstName                    String   @map("first_name") @db.VarChar(255)
  lastName                     String   @map("last_name") @db.VarChar(255)
  preferredName                String?  @map("preferred_name") @db.VarChar(255)
  email                        String?  @db.VarChar(255)
  age                          Int
  gender                       Gender
  participantType              ParticipantType @map("participant_type")
  clergyTitle                  ClergyTitle? @map("clergy_title")
  tShirtSize                   String?  @map("t_shirt_size") @db.VarChar(10)
  liabilityFormCompleted       Boolean  @default(false) @map("liability_form_completed")
  liabilityFormUrl             String?  @map("liability_form_url") @db.Text
  safeEnvironmentCertUrl       String?  @map("safe_environment_cert_url") @db.Text
  safeEnvironmentCertStatus    SafeEnvironmentStatus? @map("safe_environment_cert_status")
  parentEmail                  String?  @map("parent_email") @db.VarChar(255)
  createdAt                    DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                    DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  groupRegistration GroupRegistration @relation(fields: [groupRegistrationId], references: [id], onDelete: Cascade)
  organization      Organization      @relation(fields: [organizationId], references: [id])
  liabilityForms    LiabilityForm[]
  safeEnvironmentCertificates SafeEnvironmentCertificate[]

  @@index([groupRegistrationId], name: "idx_participant_group")
  @@index([participantType], name: "idx_participant_type")
  @@map("participants")
}

// ===================================
// PAYMENT TABLES
// ===================================

model Payment {
  id                    String   @id @default(uuid()) @db.Uuid
  organizationId        String   @map("organization_id") @db.Uuid
  eventId               String   @map("event_id") @db.Uuid
  registrationId        String   @map("registration_id") @db.Uuid
  registrationType      RegistrationType @map("registration_type")
  amount                Decimal  @db.Decimal(10, 2)
  paymentType           PaymentType @map("payment_type")
  paymentMethod         PaymentMethod @map("payment_method")
  paymentStatus         PaymentStatus @map("payment_status")
  stripePaymentIntentId String?  @unique @map("stripe_payment_intent_id") @db.VarChar(255)
  stripeChargeId        String?  @map("stripe_charge_id") @db.VarChar(255)
  receiptUrl            String?  @map("receipt_url") @db.Text
  checkNumber           String?  @map("check_number") @db.VarChar(50)
  checkDate             DateTime? @map("check_date") @db.Date
  checkReceivedDate     DateTime? @map("check_received_date") @db.Date
  cardLast4             String?  @map("card_last_4") @db.VarChar(4)
  cardholderName        String?  @map("cardholder_name") @db.VarChar(255)
  authorizationCode     String?  @map("authorization_code") @db.VarChar(255)
  paymentMethodDetails  String?  @map("payment_method_details") @db.Text
  transactionReference  String?  @map("transaction_reference") @db.VarChar(255)
  notes                 String?  @db.Text
  processedAt           DateTime? @map("processed_at") @db.Timestamptz(6)
  createdAt             DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt             DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  organization Organization @relation(fields: [organizationId], references: [id])

  @@index([registrationId, registrationType], name: "idx_payment_registration")
  @@index([stripePaymentIntentId], name: "idx_payment_stripe")
  @@map("payments")
}

model PaymentBalance {
  id                String   @id @default(uuid()) @db.Uuid
  organizationId    String   @map("organization_id") @db.Uuid
  eventId           String   @map("event_id") @db.Uuid
  registrationId    String   @unique @map("registration_id") @db.Uuid
  registrationType  RegistrationType @map("registration_type")
  totalAmountDue    Decimal  @map("total_amount_due") @db.Decimal(10, 2)
  amountPaid        Decimal  @default(0.00) @map("amount_paid") @db.Decimal(10, 2)
  amountRemaining   Decimal  @map("amount_remaining") @db.Decimal(10, 2)
  lateFeesApplied   Decimal  @default(0.00) @map("late_fees_applied") @db.Decimal(10, 2)
  lastPaymentDate   DateTime? @map("last_payment_date") @db.Timestamptz(6)
  paymentStatus     PaymentBalanceStatus @map("payment_status")
  createdAt         DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  organization Organization @relation(fields: [organizationId], references: [id])

  @@index([registrationId], name: "idx_balance_registration")
  @@index([eventId], name: "idx_balance_event")
  @@map("payment_balances")
}

// ===================================
// LIABILITY FORM TABLES
// ===================================

model LiabilityForm {
  id                        String   @id @default(uuid()) @db.Uuid
  organizationId            String   @map("organization_id") @db.Uuid
  eventId                   String   @map("event_id") @db.Uuid
  groupRegistrationId       String?  @map("group_registration_id") @db.Uuid
  participantId             String?  @map("participant_id") @db.Uuid
  individualRegistrationId  String?  @map("individual_registration_id") @db.Uuid
  formType                  LiabilityFormType @map("form_type")
  participantType           ParticipantType? @map("participant_type")
  participantFirstName      String   @map("participant_first_name") @db.VarChar(255)
  participantLastName       String   @map("participant_last_name") @db.VarChar(255)
  participantPreferredName  String?  @map("participant_preferred_name") @db.VarChar(255)
  participantAge            Int?     @map("participant_age")
  participantGender         Gender?  @map("participant_gender")
  participantEmail          String?  @map("participant_email") @db.VarChar(255)
  participantPhone          String?  @map("participant_phone") @db.VarChar(20)
  tShirtSize                String?  @map("t_shirt_size") @db.VarChar(10)
  clergyTitle               ClergyTitle? @map("clergy_title")
  dioceseOfIncardination    String?  @map("diocese_of_incardination") @db.VarChar(255)
  currentAssignment         String?  @map("current_assignment") @db.VarChar(255)
  facultyInformation        String?  @map("faculty_information") @db.Text
  parentEmail               String?  @map("parent_email") @db.VarChar(255)
  parentToken               String?  @unique @map("parent_token") @db.VarChar(255)
  parentTokenExpiresAt      DateTime? @map("parent_token_expires_at") @db.Timestamptz(6)
  medicalConditions         String?  @map("medical_conditions") @db.Text
  medications               String?  @db.Text
  allergies                 String?  @db.Text
  dietaryRestrictions       String?  @map("dietary_restrictions") @db.Text
  adaAccommodations         String?  @map("ada_accommodations") @db.Text
  emergencyContact1Name     String?  @map("emergency_contact_1_name") @db.VarChar(255)
  emergencyContact1Phone    String?  @map("emergency_contact_1_phone") @db.VarChar(20)
  emergencyContact1Relation String?  @map("emergency_contact_1_relation") @db.VarChar(100)
  emergencyContact2Name     String?  @map("emergency_contact_2_name") @db.VarChar(255)
  emergencyContact2Phone    String?  @map("emergency_contact_2_phone") @db.VarChar(20)
  emergencyContact2Relation String?  @map("emergency_contact_2_relation") @db.VarChar(100)
  insuranceProvider         String?  @map("insurance_provider") @db.VarChar(255)
  insurancePolicyNumber     String?  @map("insurance_policy_number") @db.VarChar(100)
  insuranceGroupNumber      String?  @map("insurance_group_number") @db.VarChar(100)
  signatureData             Json     @map("signature_data")
  completed                 Boolean  @default(false)
  completedByEmail          String?  @map("completed_by_email") @db.VarChar(255)
  completedAt               DateTime? @map("completed_at") @db.Timestamptz(6)
  pdfUrl                    String?  @map("pdf_url") @db.Text
  createdAt                 DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt                 DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  organization           Organization            @relation(fields: [organizationId], references: [id])
  event                  Event                   @relation(fields: [eventId], references: [id])
  groupRegistration      GroupRegistration?      @relation(fields: [groupRegistrationId], references: [id])
  participant            Participant?            @relation(fields: [participantId], references: [id])
  individualRegistration IndividualRegistration? @relation(fields: [individualRegistrationId], references: [id])
  safeEnvironmentCertificates SafeEnvironmentCertificate[]

  @@index([organizationId], name: "idx_liability_org")
  @@index([eventId], name: "idx_liability_event")
  @@index([groupRegistrationId], name: "idx_liability_group")
  @@index([participantId], name: "idx_liability_participant")
  @@index([parentToken], name: "idx_liability_parent_token")
  @@map("liability_forms")
}

model SafeEnvironmentCertificate {
  id                  String   @id @default(uuid()) @db.Uuid
  participantId       String   @map("participant_id") @db.Uuid
  liabilityFormId     String?  @map("liability_form_id") @db.Uuid
  organizationId      String   @map("organization_id") @db.Uuid
  fileUrl             String   @map("file_url") @db.Text
  originalFilename    String?  @map("original_filename") @db.VarChar(255)
  fileSizeBytes       BigInt?  @map("file_size_bytes")
  programName         String?  @map("program_name") @db.VarChar(255)
  completionDate      DateTime? @map("completion_date") @db.Date
  expirationDate      DateTime? @map("expiration_date") @db.Date
  status              CertificateStatus @default(pending)
  uploadedByUserId    String?  @map("uploaded_by_user_id") @db.Uuid
  uploadedAt          DateTime @default(now()) @map("uploaded_at") @db.Timestamptz(6)
  verifiedAt          DateTime? @map("verified_at") @db.Timestamptz(6)
  verifiedByUserId    String?  @map("verified_by_user_id") @db.Uuid

  // Relations
  participant      Participant @relation(fields: [participantId], references: [id])
  liabilityForm    LiabilityForm? @relation(fields: [liabilityFormId], references: [id])
  organization     Organization @relation(fields: [organizationId], references: [id])
  uploadedBy       User? @relation("UploadedCertificates", fields: [uploadedByUserId], references: [id])
  verifiedBy       User? @relation("VerifiedCertificates", fields: [verifiedByUserId], references: [id])

  @@index([participantId], name: "idx_cert_participant")
  @@index([organizationId], name: "idx_cert_org")
  @@index([status], name: "idx_cert_status")
  @@map("safe_environment_certificates")
}

model LiabilityFormTemplate {
  id                String   @id @default(uuid()) @db.Uuid
  organizationId    String   @map("organization_id") @db.Uuid
  eventId           String?  @map("event_id") @db.Uuid
  formType          LiabilityFormType @map("form_type")
  customQuestions   Json?    @map("custom_questions")
  customSections    Json?    @map("custom_sections")
  active            Boolean  @default(true)
  createdAt         DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt         DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  organization Organization @relation(fields: [organizationId], references: [id])
  event        Event?       @relation(fields: [eventId], references: [id])

  @@index([organizationId], name: "idx_template_org")
  @@index([eventId], name: "idx_template_event")
  @@map("liability_form_templates")
}

// ===================================
// ENUMS
// ===================================

enum OrganizationType {
  diocese
  archdiocese
  parish
  seminary
  retreat_center
  other
}

enum SubscriptionTier {
  starter
  small
  growing
  conference
  enterprise
}

enum SubscriptionStatus {
  active
  archived
  suspended
  trial
}

enum UserRole {
  master_admin
  org_admin
  group_leader
  individual
  parent
  salve_user
  rapha_user
}

enum EventStatus {
  draft
  published
  registration_open
  registration_closed
  in_progress
  completed
}

enum HousingType {
  on_campus
  off_campus
  day_pass
}

enum RegistrationStatus {
  incomplete
  pending_forms
  pending_payment
  complete
}

enum Gender {
  male
  female
  prefer_not_to_say
}

enum RoomType {
  single
  double
  triple
  quad
}

enum ParticipantType {
  youth_u18
  youth_o18
  chaperone
  priest
}

enum ClergyTitle {
  father
  deacon
  mr
  most_reverend
  seminarian
}

enum SafeEnvironmentStatus {
  not_required
  pending
  uploaded
  verified
}

enum PaymentType {
  deposit
  balance
  late_fee
  refund
}

enum PaymentMethod {
  card
  check
  cash
  bank_transfer
  other
}

enum PaymentStatus {
  pending
  processing
  succeeded
  failed
  cancelled
  refunded
}

enum RegistrationType {
  group
  individual
}

enum PaymentBalanceStatus {
  unpaid
  partial
  paid_full
  overpaid
  refunded
  pending_check_payment
}

enum LiabilityFormType {
  youth_u18
  youth_o18_chaperone
  clergy
}

enum CertificateStatus {
  pending
  verified
  rejected
  expired
}

enum QuestionType {
  text
  yes_no
  multiple_choice
  dropdown
}

enum QuestionAppliesTo {
  group
  individual
  both
}

enum WaitlistStatus {
  pending
  contacted
  registered
  expired
}

enum EditType {
  info_updated
  participant_added
  participant_removed
  payment_updated
  refund_processed
}

enum RefundMethod {
  stripe
  manual
}

enum RefundReason {
  participant_removed
  group_cancellation
  event_cancellation
  overpayment_correction
  emergency_illness
  other
}

enum RefundStatus {
  pending
  completed
  failed
}

// ===================================
// CUSTOM REGISTRATION QUESTIONS
// ===================================

model CustomRegistrationQuestion {
  id            String   @id @default(uuid()) @db.Uuid
  eventId       String   @map("event_id") @db.Uuid
  questionText  String   @map("question_text") @db.Text
  questionType  QuestionType @map("question_type")
  options       Json?
  required      Boolean  @default(false)
  appliesTo     QuestionAppliesTo @map("applies_to")
  displayOrder  Int      @default(0) @map("display_order")
  createdAt     DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt     DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  event   Event                          @relation(fields: [eventId], references: [id], onDelete: Cascade)
  answers CustomRegistrationAnswer[]

  @@index([eventId], name: "idx_custom_questions_event")
  @@map("custom_registration_questions")
}

model CustomRegistrationAnswer {
  id               String   @id @default(uuid()) @db.Uuid
  questionId       String   @map("question_id") @db.Uuid
  registrationId   String   @map("registration_id") @db.Uuid
  registrationType RegistrationType @map("registration_type")
  answerText       String?  @map("answer_text") @db.Text
  createdAt        DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt        DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  question CustomRegistrationQuestion @relation(fields: [questionId], references: [id], onDelete: Cascade)

  @@index([questionId], name: "idx_custom_answers_question")
  @@index([registrationId, registrationType], name: "idx_custom_answers_registration")
  @@map("custom_registration_answers")
}

// ===================================
// WAITLIST TABLES
// ===================================

model WaitlistEntry {
  id         String   @id @default(uuid()) @db.Uuid
  eventId    String   @map("event_id") @db.Uuid
  name       String   @db.VarChar(255)
  email      String   @db.VarChar(255)
  phone      String?  @db.VarChar(20)
  partySize  Int      @default(1) @map("party_size")
  notes      String?  @db.Text
  status     WaitlistStatus @default(pending)
  notifiedAt DateTime? @map("notified_at") @db.Timestamptz(6)
  createdAt  DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt  DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  event Event @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@index([eventId], name: "idx_waitlist_event")
  @@index([status], name: "idx_waitlist_status")
  @@index([email], name: "idx_waitlist_email")
  @@map("waitlist_entries")
}

// ===================================
// REGISTRATION MANAGEMENT TABLES
// ===================================

model RegistrationEdit {
  id                  String   @id @default(uuid()) @db.Uuid
  registrationId      String   @map("registration_id") @db.Uuid
  registrationType    RegistrationType @map("registration_type")
  editedByUserId      String   @map("edited_by_user_id") @db.Uuid
  editedAt            DateTime @default(now()) @map("edited_at") @db.Timestamptz(6)
  editType            EditType @map("edit_type")
  changesMade         Json?    @map("changes_made")
  oldTotal            Decimal? @map("old_total") @db.Decimal(10, 2)
  newTotal            Decimal? @map("new_total") @db.Decimal(10, 2)
  difference          Decimal? @db.Decimal(10, 2)
  adminNotes          String?  @map("admin_notes") @db.Text
  emailSent           Boolean  @default(false) @map("email_sent")
  createdAt           DateTime @default(now()) @map("created_at") @db.Timestamptz(6)

  // Relations
  editedBy User @relation(fields: [editedByUserId], references: [id])

  @@index([registrationId], name: "idx_reg_edit_registration")
  @@index([editedByUserId], name: "idx_reg_edit_user")
  @@index([editedAt], name: "idx_reg_edit_date")
  @@map("registration_edits")
}

model Refund {
  id                  String   @id @default(uuid()) @db.Uuid
  registrationId      String   @map("registration_id") @db.Uuid
  registrationType    RegistrationType @map("registration_type")
  refundAmount        Decimal  @map("refund_amount") @db.Decimal(10, 2)
  refundMethod        RefundMethod @map("refund_method")
  refundReason        RefundReason @map("refund_reason")
  notes               String?  @db.Text
  processedByUserId   String   @map("processed_by_user_id") @db.Uuid
  processedAt         DateTime @default(now()) @map("processed_at") @db.Timestamptz(6)
  stripeRefundId      String?  @map("stripe_refund_id") @db.VarChar(255)
  status              RefundStatus @default(pending)
  createdAt           DateTime @default(now()) @map("created_at") @db.Timestamptz(6)
  updatedAt           DateTime @updatedAt @map("updated_at") @db.Timestamptz(6)

  // Relations
  processedBy User @relation(fields: [processedByUserId], references: [id])

  @@index([registrationId], name: "idx_refund_registration")
  @@index([processedByUserId], name: "idx_refund_user")
  @@index([status], name: "idx_refund_status")
  @@map("refunds")
}

